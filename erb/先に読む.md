# はじめに

ウェブサービスでは、ユーザーのマイページや投稿一覧などのように、アクセスする毎、ユーザー毎に異なるページを表示しなくてはいけません。
普通のhtmlファイルは書いてある内容が固定されているので、通常のhtmlだけで対応しようとすると、ユーザー毎にhtmlファイルを
用意しなくてはならず、現実的ではありませんね。

そこで、Railsでは、erbという機能を使って、自動的にhtmlを生成します。
と、言葉で言ってもよく理解できないので、実際にプログラムを組んで実験してみましょう。

使用するファイルはindex.html.erbと、main.rbです。

erbフォルダを新しく作り、その中に上記２つのファイルを作成します。

main.rbはindex.html.erbから、index.htmlを生成するためのプログラムです。
index.html.erbは、テンプレートファイルと呼ばれるもので、ユーザー毎に共通の事項はhtmlで書いてありますが、
変化する部分にはrubyのコードが埋め込まれています。

実行方法は、まずターミナルでerbフォルダへ移動し(erbフォルダを作っているのであれば)、

```
ruby main.rb
```

というコマンドを実行します。

すると、erbフォルダへindex.htmlというファイルが作られます。このファイルは通常のhtmlファイルですので、プレビューなどでみる事ができます。

# erbの書き方
基本的には、htmlで書きます。

erbでは、その中にrubyのコードを埋め込む事ができるのですが、埋め込み方は次の２種類あります。

* <%= %>

こちらは、中に書いたrubyのコードの実行結果をhtmlとして出力したい場合です。

```
<%= title %>
```

titleの中身が「Ruby入門」だったとすると、htmlには、このコード(<%= title %>)を書いた場所に「Ruby入門」が置き換わるイメージです。

* <% %>
こちらの=無しのバージョンは、中に書いたrubyコードを実行するけど、画面には表示させたくない時です。
例えば、繰り返し処理を行うeachメソッドは、実行した結果、繰り返した配列(あるいはハッシュ)がメソッドの返り値になります。

そのため、

```
<%= [1,2,3].each do |number| %>
```

のように書いてしまうと、[1,2,3]が画面に表示されてしまいます。

* 繰り返し
繰り返しには基本的に<% %>の方を使いますが、do~endの処理部分では、表示したい項目を<%= %>囲みます。

```
<ul>
  <% [1,2,3].each do |number| %>
    <li>
      <p> No.<%= number %> </p>
    <li>
  <% end %>
</ul>
```

↓

```
<ul>
    <li>
      <p> No.1 </p>
    <li>
    <li>
      <p> No.2 </p>
    <li>
    <li>
      <p> No.3 </p>
    <li>
</ul>
```


* if

もちろん、ifも使う事ができます。ifも繰り返しと同様に、基本的には=なしを使います。
以下の例で用いているuserやlogged_in?メソッドはダミーです。このまま書いても動きません。

```
<% if user.logged_in? %>
  こんにちは<%= user.name %>さん
<% else %>
  ログインしてください。
<% end %>
```
↓

・ログインしている場合
こんにちはUotaniさん

・ログインしていない場合
ログインしてください。


* 変数

erbファイルの中で、変数を新しく作ることもできます。

```
<% blog_count = user.favorite_blogs.size %>
お気に入りのブログは<%= blog_count %>件です。
```
↓

```
お気に入りのブログは10件です。
```